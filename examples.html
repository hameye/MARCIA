
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="canonical" href="https://hameye.github.io/MARCIA/examples.html">
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.4">
    
    
      
        <title>API Reference - MARCIA Documentation</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.bde7dde4.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.ef6f36e2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL(".",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#workflow" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="MARCIA Documentation" class="md-header__button md-logo" aria-label="MARCIA Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MARCIA Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Reference
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/hameye/marcia/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    hameye/marcia
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="MARCIA Documentation" class="md-nav__button md-logo" aria-label="MARCIA Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    MARCIA Documentation
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/hameye/marcia/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    hameye/marcia
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          API Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="examples.html" class="md-nav__link md-nav__link--active">
        API Reference
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#marcia.mask-classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask" class="md-nav__link">
    Mask
  </a>
  
    <nav class="md-nav" aria-label="Mask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask-methods" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav" aria-label="Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask.create_mineral_mask" class="md-nav__link">
    create_mineral_mask()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask.cube_masking_keep" class="md-nav__link">
    cube_masking_keep()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask.cube_masking_remove" class="md-nav__link">
    cube_masking_remove()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask.datacube_creation" class="md-nav__link">
    datacube_creation()
  </a>
  
    <nav class="md-nav" aria-label="datacube_creation()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask.datacube_creation--three-types-of-elemental-files-are-accepted" class="md-nav__link">
    Three types of elemental files are accepted
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask.get_biplot" class="md-nav__link">
    get_biplot()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask.get_hist" class="md-nav__link">
    get_hist()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask.get_mask" class="md-nav__link">
    get_mask()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask.get_masked_element" class="md-nav__link">
    get_masked_element()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask.get_triplot" class="md-nav__link">
    get_triplot()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask.load_table" class="md-nav__link">
    load_table()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask.mineralcube_creation" class="md-nav__link">
    mineralcube_creation()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask.plot_mineral_mask" class="md-nav__link">
    plot_mineral_mask()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask.save_mask" class="md-nav__link">
    save_mask()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask.save_mask_spectrum" class="md-nav__link">
    save_mask_spectrum()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="examples/Tutorial.html" class="md-nav__link">
        Docs
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#marcia.mask-classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask" class="md-nav__link">
    Mask
  </a>
  
    <nav class="md-nav" aria-label="Mask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask-methods" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav" aria-label="Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask.create_mineral_mask" class="md-nav__link">
    create_mineral_mask()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask.cube_masking_keep" class="md-nav__link">
    cube_masking_keep()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask.cube_masking_remove" class="md-nav__link">
    cube_masking_remove()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask.datacube_creation" class="md-nav__link">
    datacube_creation()
  </a>
  
    <nav class="md-nav" aria-label="datacube_creation()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask.datacube_creation--three-types-of-elemental-files-are-accepted" class="md-nav__link">
    Three types of elemental files are accepted
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask.get_biplot" class="md-nav__link">
    get_biplot()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask.get_hist" class="md-nav__link">
    get_hist()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask.get_mask" class="md-nav__link">
    get_mask()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask.get_masked_element" class="md-nav__link">
    get_masked_element()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask.get_triplot" class="md-nav__link">
    get_triplot()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask.load_table" class="md-nav__link">
    load_table()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask.mineralcube_creation" class="md-nav__link">
    mineralcube_creation()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask.plot_mineral_mask" class="md-nav__link">
    plot_mineral_mask()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask.save_mask" class="md-nav__link">
    save_mask()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#marcia.mask.Mask.save_mask_spectrum" class="md-nav__link">
    save_mask_spectrum()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/hameye/marcia/edit/master/docs/examples.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="workflow">Workflow</h1>


  <div class="doc doc-object doc-module">


    <div class="doc doc-contents first">




  <div class="doc doc-children">





<h2 id="marcia.mask-classes">Classes</h2>

  <div class="doc doc-object doc-class">



<h3 class="doc doc-heading" id="marcia.mask.Mask">
        <code>Mask</code>



</h3>

    <div class="doc doc-contents ">

      <p>Class that allows to do a mineralogical classification of a
sample provided the elemental data and a spreadsheet containing
the elemental information needed for each mineral.
The classification indicates the minerals, the percentage of each,
the percentage of pixels that are classified more than once.
It also indicates the percentage of the number of pixel that are not
indexed.
It also enables to extract a binaray image per mineral in order
to use it as a mask onto the datacube (.rpl file) to facilitate
quantitative analysis by the software.</p>
<p>The spreadsheet can contain elemental and ratios querries and also a line
for the color querries.</p>

<p><strong>Attributes:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>prefix</code></td>
        <td><code></code></td>
        <td><p>Common name to all data files (eg: lead_ore_).</p></td>
      </tr>
      <tr>
        <td><code>suffix</code></td>
        <td><code></code></td>
        <td><p>Type of the data file.</p></td>
      </tr>
      <tr>
        <td><code>table</code></td>
        <td><code></code></td>
        <td><p>Name of spreadsheet containing thresholds (eg: Mask.xlsx).</p></td>
      </tr>
      <tr>
        <td><code>normalization</code></td>
        <td><code></code></td>
        <td><p>Indicate if data are normalized or not, only valid</p></td>
      </tr>
      <tr>
        <td><code>test</code></td>
        <td><code>str</code></td>
        <td><p>test</p></td>
      </tr>
  </tbody>
</table>



  <div class="doc doc-children">








<h4 id="marcia.mask.Mask-methods">Methods</h4>

  <div class="doc doc-object doc-method">



<h5 class="doc doc-heading" id="marcia.mask.Mask.create_mineral_mask">
<code class="highlight language-python"><span class="n">create_mineral_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Create a 2D array that associate each pixel to a mask
by assigning a value to each pixel. It also creates a
dictionnary containing the relative proportion of a value
compared to others.</p>

        <details class="quote">
          <summary>Source code in <code>marcia/mask.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">create_mineral_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a 2D array that associate each pixel to a mask</span>
<span class="sd">    by assigning a value to each pixel. It also creates a</span>
<span class="sd">    dictionnary containing the relative proportion of a value</span>
<span class="sd">    compared to others.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Creation of proportion dictionnary</span>
    <span class="n">proportion</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Initialization of 2D array</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="c1"># Convert the array to nan values</span>
    <span class="n">array</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">array</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="c1"># Loop over the mask to check pixels that are assigned more than once</span>
    <span class="k">for</span> <span class="n">indice</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Minerals</span><span class="p">)):</span>
        <span class="n">array</span><span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mineral_cube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">indice</span><span class="p">]))</span> <span class="o">&amp;</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mineral_cube</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">indice</span>
    <span class="n">array</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mineral_cube</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
          <span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Minerals</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">indice</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Minerals</span><span class="p">)):</span>
        <span class="n">proportion</span><span class="p">[</span><span class="n">indice</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">array</span> <span class="o">==</span> <span class="n">indice</span><span class="p">)[</span>
            <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">array</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="k">return</span> <span class="n">array</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 class="doc doc-heading" id="marcia.mask.Mask.cube_masking_keep">
<code class="highlight language-python"><span class="n">cube_masking_keep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mineral</span><span class="p">)</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Recreates a raw datacube containing data only
in the wanted mask.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>mineral</code></td>
        <td><code>str</code></td>
        <td><p>Name of the wanted mask (eg: 'Galene').</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>marcia/mask.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">cube_masking_keep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mineral</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Recreates a raw datacube containing data only</span>
<span class="sd">    in the wanted mask.</span>

<span class="sd">    Args:</span>
<span class="sd">        mineral: Name of the wanted mask (eg: &#39;Galene&#39;).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Conversion of given string indices to integer indice of the cube</span>
    <span class="n">mineral</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Minerals</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">mineral</span><span class="p">))</span>
    <span class="n">cube</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.rpl&quot;</span><span class="p">,</span>
                   <span class="n">signal_type</span><span class="o">=</span><span class="s2">&quot;EDS_SEM&quot;</span><span class="p">,</span>
                   <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">cube</span><span class="p">)</span>
    <span class="n">array</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mineral_cube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">mineral</span><span class="p">])]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">cube</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">signals</span><span class="o">.</span><span class="n">Signal1D</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="n">cube</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_mask_kept_&#39;</span> <span class="o">+</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">Minerals</span><span class="p">[</span><span class="n">mineral</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.rpl&quot;</span><span class="p">,</span>
              <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.rpl&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_mask_kept_&#39;</span> <span class="o">+</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">Minerals</span><span class="p">[</span><span class="n">mineral</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.rpl&quot;</span><span class="p">,</span>
                  <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">output</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 class="doc doc-heading" id="marcia.mask.Mask.cube_masking_remove">
<code class="highlight language-python"><span class="n">cube_masking_remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mineral</span><span class="p">)</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Recreates a raw datacube containing all the
data without the mask not wanted.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>mineral</code></td>
        <td><code>str</code></td>
        <td><p>Name of the wanted mask (eg: 'Galene')</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>marcia/mask.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">cube_masking_remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mineral</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Recreates a raw datacube containing all the</span>
<span class="sd">    data without the mask not wanted.</span>

<span class="sd">    Args:</span>
<span class="sd">        mineral : Name of the wanted mask (eg: &#39;Galene&#39;)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Conversion of given string indices to integer indice of the cube</span>
    <span class="k">if</span> <span class="n">mineral</span> <span class="o">==</span> <span class="s1">&#39;mixed&#39;</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_mineral_mask</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">mixed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
        <span class="n">cube</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.rpl&quot;</span><span class="p">,</span>
                       <span class="n">signal_type</span><span class="o">=</span><span class="s2">&quot;EDS_SEM&quot;</span><span class="p">,</span>
                       <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">cube</span><span class="p">)</span>
        <span class="n">array</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">mixed</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cube</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">signals</span><span class="o">.</span><span class="n">Signal1D</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
        <span class="n">cube</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_mask_removed_mixed&#39;</span> <span class="o">+</span> <span class="s2">&quot;.rpl&quot;</span><span class="p">,</span>
                  <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.rpl&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_mask_removed_mixed&#39;</span> <span class="o">+</span> <span class="s2">&quot;.rpl&quot;</span><span class="p">,</span>
                      <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">output</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">mineral</span> <span class="o">==</span> <span class="s1">&#39;not indexed&#39;</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_mineral_mask</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
        <span class="n">cube</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.rpl&quot;</span><span class="p">,</span>
                       <span class="n">signal_type</span><span class="o">=</span><span class="s2">&quot;EDS_SEM&quot;</span><span class="p">,</span>
                       <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">cube</span><span class="p">)</span>
        <span class="n">array</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">nan</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cube</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">signals</span><span class="o">.</span><span class="n">Signal1D</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
        <span class="n">cube</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_mask_removed_nan&#39;</span> <span class="o">+</span>
                  <span class="s2">&quot;.rpl&quot;</span><span class="p">,</span>
                  <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.rpl&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_mask_removed_nan&#39;</span> <span class="o">+</span>
                      <span class="o">+</span> <span class="s2">&quot;.rpl&quot;</span><span class="p">,</span>
                      <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">output</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mineral</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Minerals</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">mineral</span><span class="p">))</span>
        <span class="n">cube</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.rpl&quot;</span><span class="p">,</span>
                       <span class="n">signal_type</span><span class="o">=</span><span class="s2">&quot;EDS_SEM&quot;</span><span class="p">,</span>
                       <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">cube</span><span class="p">)</span>
        <span class="n">array</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mineral_cube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">mineral</span><span class="p">])]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cube</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">signals</span><span class="o">.</span><span class="n">Signal1D</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
        <span class="n">cube</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_mask_removed_&#39;</span> <span class="o">+</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">Minerals</span><span class="p">[</span><span class="n">mineral</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.rpl&quot;</span><span class="p">,</span>
                  <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.rpl&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_mask_removed_&#39;</span> <span class="o">+</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">Minerals</span><span class="p">[</span><span class="n">mineral</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.rpl&quot;</span><span class="p">,</span>
                      <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">output</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 class="doc doc-heading" id="marcia.mask.Mask.datacube_creation">
<code class="highlight language-python"><span class="n">datacube_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Create a 3D array (X and Y are the dimensions of the
sample and Z dimension is the number of elements/emission lines taken
into account for the classification)
It stacks the information contained in the elemental files given ranked
according to the spreasheet ranking.
If the normalization is asked or if the elemental map is an image,
the data in the array are between 0 and 100.
If there is a scalebar, the corresponding pixels are non assigned.</p>
<h6 id="marcia.mask.Mask.datacube_creation--three-types-of-elemental-files-are-accepted">Three types of elemental files are accepted</h6>
<ul>
<li>
<p>Imges (.bmp of .tif), which are RGB files : each pixel contains 3
values between 0 and 255. The rgb is put into greyscale calculated
by the norm 2.</p>
</li>
<li>
<p>Textfile (.txt), which is already the elemental array where the
values are the number of counts.</p>
</li>
<li>
<p>Raw file (.rpl), wich is the datacube containing all the spectra
for every pixel. The hyperspy library is used to extract the
emission lines corresponding to the wanted elements.</p>
</li>
</ul>
<p>Textfiles and raw files can be normalized or not, the spreadsheet
must be written according to that.</p>
<p>The function also creates a dictionnary containing the Z position
of the element in the 3D array created.</p>
<p>2 class files created in that function.</p>

        <details class="quote">
          <summary>Source code in <code>marcia/mask.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">datacube_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a 3D array (X and Y are the dimensions of the</span>
<span class="sd">    sample and Z dimension is the number of elements/emission lines taken</span>
<span class="sd">    into account for the classification)</span>
<span class="sd">    It stacks the information contained in the elemental files given ranked</span>
<span class="sd">    according to the spreasheet ranking.</span>
<span class="sd">    If the normalization is asked or if the elemental map is an image,</span>
<span class="sd">    the data in the array are between 0 and 100.</span>
<span class="sd">    If there is a scalebar, the corresponding pixels are non assigned.</span>

<span class="sd">    Three types of elemental files are accepted</span>
<span class="sd">    -------------------------------------------</span>
<span class="sd">    - Imges (.bmp of .tif), which are RGB files : each pixel contains 3</span>
<span class="sd">    values between 0 and 255. The rgb is put into greyscale calculated</span>
<span class="sd">    by the norm 2.</span>

<span class="sd">    - Textfile (.txt), which is already the elemental array where the</span>
<span class="sd">    values are the number of counts.</span>

<span class="sd">    - Raw file (.rpl), wich is the datacube containing all the spectra</span>
<span class="sd">    for every pixel. The hyperspy library is used to extract the</span>
<span class="sd">    emission lines corresponding to the wanted elements.</span>

<span class="sd">    Textfiles and raw files can be normalized or not, the spreadsheet</span>
<span class="sd">    must be written according to that.</span>

<span class="sd">    The function also creates a dictionnary containing the Z position</span>
<span class="sd">    of the element in the 3D array created.</span>

<span class="sd">    2 class files created in that function.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if the data files are images</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;.bmp&#39;</span><span class="p">,</span> <span class="s1">&#39;.tif&#39;</span><span class="p">,</span> <span class="s1">&#39;.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;.png&#39;</span><span class="p">):</span>

        <span class="c1"># Set automatic normalization to True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normalization</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Creation of element names dictionnary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Elements</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Read the first image to know the dimensions</span>
        <span class="n">test_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
            <span class="n">imread</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span>
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span><span class="p">),</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="p">(</span><span class="n">test_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
             <span class="n">test_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="n">test_image</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Loop over elements in the table</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Elements</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;Element&#39;</span><span class="p">]</span>

            <span class="c1"># Check if the element is not a ratio of two elements</span>
            <span class="k">if</span> <span class="s1">&#39;/&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;Element&#39;</span><span class="p">]:</span>

                <span class="c1"># Load of the  RGB image and normalization to one component</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
                    <span class="n">imread</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span>
                        <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span><span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

            <span class="c1"># If the element is actually a ratio of two elements</span>
            <span class="k">else</span><span class="p">:</span>

                <span class="c1"># Load of the two images</span>
                <span class="n">image_over</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span>
                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;Element&#39;</span><span class="p">][</span><span class="n">element</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span><span class="p">)</span>
                <span class="n">image_under</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span>
                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;Element&#39;</span><span class="p">][</span><span class="n">element</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span><span class="p">)</span>

                <span class="c1"># Normalization of the two images</span>
                <span class="n">image_over_grey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">image_over</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">image_under_grey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">image_under</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

                <span class="c1"># Set 0 values to 0.01 in denominator image in order to</span>
                <span class="c1"># avoid division by 0</span>
                <span class="n">image_under_grey</span><span class="p">[</span><span class="n">image_under_grey</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.01</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="p">[</span>
                    <span class="p">:,</span> <span class="p">:,</span> <span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_over_grey</span> <span class="o">/</span> <span class="n">image_under_grey</span>

        <span class="c1"># Normalization over 100 to every element of the cube</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elements</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="p">[</span>
                <span class="p">:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="c1"># Check if data are textfiles consisting of raw count data per pixel</span>
    <span class="c1"># per energy</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s1">&#39;.txt&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Elements</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Read the first image to know the dimensions</span>
        <span class="n">test_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span><span class="p">,</span>
            <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="p">(</span><span class="n">test_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
             <span class="n">test_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">test_image</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Loop over elements in the table</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Elements</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;Element&#39;</span><span class="p">]</span>

            <span class="c1"># Check if the element is not a ratio of two elements</span>
            <span class="k">if</span> <span class="s1">&#39;/&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;Element&#39;</span><span class="p">]:</span>
                <span class="c1"># Load of the data count per element</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span>
                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span><span class="p">,</span>
                    <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>

            <span class="c1"># If the element is actually a ratio of two elements</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">image_over_grey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span>
                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;Element&#39;</span><span class="p">][</span><span class="n">element</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span><span class="p">,</span>
                    <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                <span class="n">image_under_grey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span>
                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;Element&#39;</span><span class="p">][</span><span class="n">element</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span><span class="p">,</span>
                    <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="p">[</span>
                    <span class="p">:,</span> <span class="p">:,</span> <span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_over_grey</span> <span class="o">/</span> <span class="n">image_under_grey</span>
        <span class="c1"># If user wants to see normalized over 100 data</span>
        <span class="c1"># This option makes impossible intensity comparison over element</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalization</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elements</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="p">[</span>
                    <span class="p">:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="c1"># Check if data are .rpl file, that is complete datacube</span>
    <span class="c1"># Load of the file using HyperSpy library</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s1">&#39;.rpl&#39;</span><span class="p">:</span>
        <span class="n">cube</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;.rpl&quot;</span><span class="p">,</span>
                       <span class="n">signal_type</span><span class="o">=</span><span class="s2">&quot;EDS_SEM&quot;</span><span class="p">,</span>
                       <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">cube</span><span class="o">.</span><span class="n">axes_manager</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;E&#39;</span>
        <span class="n">cube</span><span class="o">.</span><span class="n">axes_manager</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;keV&#39;</span>
        <span class="n">cube</span><span class="o">.</span><span class="n">axes_manager</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="mf">0.01</span>
        <span class="n">cube</span><span class="o">.</span><span class="n">axes_manager</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.97</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Elements</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">cube</span><span class="o">.</span><span class="n">axes_manager</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                   <span class="n">cube</span><span class="o">.</span><span class="n">axes_manager</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Elements</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;Element&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="s1">&#39;/&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;Element&#39;</span><span class="p">]:</span>
                <span class="n">cube</span><span class="o">.</span><span class="n">set_elements</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;Element&#39;</span><span class="p">]])</span>
                <span class="n">array</span> <span class="o">=</span> <span class="n">cube</span><span class="o">.</span><span class="n">get_lines_intensity</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">cube</span><span class="o">.</span><span class="n">set_elements</span><span class="p">(</span>
                    <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;Element&#39;</span><span class="p">][</span><span class="n">element</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">array</span> <span class="o">=</span> <span class="n">cube</span><span class="o">.</span><span class="n">get_lines_intensity</span><span class="p">()</span>
                <span class="n">image_over</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">cube</span><span class="o">.</span><span class="n">set_elements</span><span class="p">(</span>
                    <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;Element&#39;</span><span class="p">][</span><span class="n">element</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">array</span> <span class="o">=</span> <span class="n">cube</span><span class="o">.</span><span class="n">get_lines_intensity</span><span class="p">()</span>
                <span class="n">image_under</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                <span class="n">image_under</span><span class="p">[</span><span class="n">image_under</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.001</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="p">[</span>
                    <span class="p">:,</span> <span class="p">:,</span> <span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_over</span> <span class="o">/</span> <span class="n">image_under</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalization</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elements</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="p">[</span>
                    <span class="p">:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="c1"># Raise Exception to provide valide data type</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> invalid data type. &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;Valid data types are: &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;.png, .bmp, .tif, .txt or .rpl &quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 class="doc doc-heading" id="marcia.mask.Mask.get_biplot">
<code class="highlight language-python"><span class="n">get_biplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indicex</span><span class="p">,</span> <span class="n">indicey</span><span class="p">)</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Plot one element against another one in a scatter plot
Input is the indexes of each of the two element in the 3D array
Useful function in order to see elemental ratios and some
elemental thresholds.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>indicex</code></td>
        <td><code>str</code></td>
        <td><p>Name of the wanted element on x axis (eg: 'Fe').</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>indicey</code></td>
        <td><code>str</code></td>
        <td><p>Name of the wanted element on y axis (eg: 'Pb').</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>marcia/mask.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_biplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indicex</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indicey</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot one element against another one in a scatter plot</span>
<span class="sd">    Input is the indexes of each of the two element in the 3D array</span>
<span class="sd">    Useful function in order to see elemental ratios and some</span>
<span class="sd">    elemental thresholds.</span>

<span class="sd">    Args:</span>
<span class="sd">        indicex: Name of the wanted element on x axis (eg: &#39;Fe&#39;).</span>
<span class="sd">        indicey: Name of the wanted element on y axis (eg: &#39;Pb&#39;).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Conversion of given string indices to integer indices of the cubes</span>
    <span class="n">indicex</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elements</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">indicex</span><span class="p">))</span>
    <span class="n">indicey</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elements</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">indicey</span><span class="p">))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

    <span class="c1"># Number of points limited to 100,000 for computationnal time</span>

    <span class="n">Valuesx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="p">[</span>
        <span class="p">:,</span> <span class="p">:,</span> <span class="n">indicex</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">indicex</span><span class="p">])]</span>
    <span class="n">Valuesy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="p">[</span>
        <span class="p">:,</span> <span class="p">:,</span> <span class="n">indicey</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">indicey</span><span class="p">])]</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">Valuesx</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">Valuesy</span><span class="p">}</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># Limit number of samples to 100,000</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100000</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of points limited to 100000&#39;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">100000</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Valuesx</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Valuesy</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elements</span><span class="p">[</span><span class="n">indicex</span><span class="p">]))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elements</span><span class="p">[</span><span class="n">indicey</span><span class="p">]))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 class="doc doc-heading" id="marcia.mask.Mask.get_hist">
<code class="highlight language-python"><span class="n">get_hist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indice</span><span class="p">)</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Plot the elemental map on the left side an
the corresponding hitogram of intensity on the right side
Input is the index of the element in the 3D array
Useful function in order to set the threshold in the spreadsheet.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>indice</code></td>
        <td><code>str</code></td>
        <td><p>Name of the wanted element (eg: 'Fe')</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>marcia/mask.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_hist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indice</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the elemental map on the left side an</span>
<span class="sd">    the corresponding hitogram of intensity on the right side</span>
<span class="sd">    Input is the index of the element in the 3D array</span>
<span class="sd">    Useful function in order to set the threshold in the spreadsheet.</span>

<span class="sd">    Args:</span>
<span class="sd">        indice: Name of the wanted element (eg: &#39;Fe&#39;)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Conversion of given string indices to integer indice of the cube</span>
    <span class="n">indice</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elements</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">indice</span><span class="p">))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

    <span class="c1"># Keep only finite values</span>
    <span class="n">finite_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">indice</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">indice</span><span class="p">])]</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">indice</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Carte lmentaire : &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Elements</span><span class="p">[</span><span class="n">indice</span><span class="p">])</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">finite_data</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">finite_data</span><span class="p">,</span>
                 <span class="n">kde</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                 <span class="n">hist_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">finite_data</span><span class="p">))},</span>
                 <span class="n">vertical</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Logarithm scale because background has a lof ot points and flatten</span>
    <span class="c1"># interesting information if linear</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Histograme d&#39;intensit : &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Elements</span><span class="p">[</span><span class="n">indice</span><span class="p">])</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 class="doc doc-heading" id="marcia.mask.Mask.get_mask">
<code class="highlight language-python"><span class="n">get_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indice</span><span class="p">)</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Plot the mineral mask wanted
Input is the index of the mineral in the 3D array (cube).</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>indice</code></td>
        <td><code>str</code></td>
        <td><p>Name of the wanted mask (eg: 'Galene').</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>marcia/mask.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indice</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the mineral mask wanted</span>
<span class="sd">    Input is the index of the mineral in the 3D array (cube).</span>

<span class="sd">    Args:</span>
<span class="sd">        indice: Name of the wanted mask (eg: &#39;Galene&#39;).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Conversion of given string indices to integer indice of the cube</span>
    <span class="n">indice</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Minerals</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">indice</span><span class="p">))</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mineral_cube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">indice</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Minerals</span><span class="p">[</span><span class="n">indice</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 class="doc doc-heading" id="marcia.mask.Mask.get_masked_element">
<code class="highlight language-python"><span class="n">get_masked_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">mineral</span><span class="p">)</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Plot the elemental map and the histogram
associated only in a specific mask.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>element</code></td>
        <td><code>str</code></td>
        <td><p>Name of the wanted element (eg: 'Fe').</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>mineral</code></td>
        <td><code>str</code></td>
        <td><p>Name of the wanted mask (eg: 'Galene').</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>marcia/mask.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_masked_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">mineral</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the elemental map and the histogram</span>
<span class="sd">    associated only in a specific mask.</span>

<span class="sd">    Args:</span>
<span class="sd">        element: Name of the wanted element (eg: &#39;Fe&#39;).</span>
<span class="sd">        mineral: Name of the wanted mask (eg: &#39;Galene&#39;).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Conversion of given string indices to integer indices of the cubes</span>
    <span class="n">element</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elements</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">element</span><span class="p">))</span>
    <span class="n">mineral</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Minerals</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">mineral</span><span class="p">))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">Anan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">element</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">element</span><span class="p">])]</span>
    <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">element</span><span class="p">]</span>
    <span class="n">array</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mineral_cube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">mineral</span><span class="p">])]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Carte lmentaire de </span><span class="si">{}</span><span class="s2"> masqu par </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Elements</span><span class="p">[</span><span class="n">element</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Minerals</span><span class="p">[</span><span class="n">mineral</span><span class="p">]))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Anan</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">Anan</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">hist_kws</span><span class="o">=</span><span class="p">{</span>
                 <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Anan</span><span class="p">))},</span> <span class="n">vertical</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Histograme d&#39;intensit : &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Elements</span><span class="p">[</span><span class="n">element</span><span class="p">])</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 class="doc doc-heading" id="marcia.mask.Mask.get_triplot">
<code class="highlight language-python"><span class="n">get_triplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indicex</span><span class="p">,</span> <span class="n">indicey</span><span class="p">,</span> <span class="n">indicez</span><span class="p">)</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Plot one element against another one in a scatter plot
Input is the indexes of each of the two element in the 3D array
Useful function in order to see elemental ratios and some elemental
thresholds.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>indicex</code></td>
        <td><code>str</code></td>
        <td><p>Name of the wanted element on x axis(eg: 'Fe').</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>indicey</code></td>
        <td><code>str</code></td>
        <td><p>Name of the wanted element on y axis (eg: 'Pb').</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>indicez</code></td>
        <td><code>str</code></td>
        <td><p>Name of the wanted element on colorscale (eg: 'Cu').</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>marcia/mask.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_triplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indicex</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indicey</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indicez</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot one element against another one in a scatter plot</span>
<span class="sd">    Input is the indexes of each of the two element in the 3D array</span>
<span class="sd">    Useful function in order to see elemental ratios and some elemental</span>
<span class="sd">    thresholds.</span>

<span class="sd">    Args:</span>
<span class="sd">        indicex: Name of the wanted element on x axis(eg: &#39;Fe&#39;).</span>
<span class="sd">        indicey: Name of the wanted element on y axis (eg: &#39;Pb&#39;).</span>
<span class="sd">        indicez: Name of the wanted element on colorscale (eg: &#39;Cu&#39;).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Conversion of given string indices to integer indices of the cubes</span>
    <span class="n">indicex</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elements</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">indicex</span><span class="p">))</span>
    <span class="n">indicey</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elements</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">indicey</span><span class="p">))</span>
    <span class="n">indicez</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elements</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">indicez</span><span class="p">))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">Valuesx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="p">[</span>
        <span class="p">:,</span> <span class="p">:,</span> <span class="n">indicex</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">indicex</span><span class="p">])]</span>
    <span class="n">Valuesy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="p">[</span>
        <span class="p">:,</span> <span class="p">:,</span> <span class="n">indicey</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">indicey</span><span class="p">])]</span>
    <span class="n">Valuesz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="p">[</span>
        <span class="p">:,</span> <span class="p">:,</span> <span class="n">indicez</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">indicez</span><span class="p">])]</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">Valuesx</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">Valuesy</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="n">Valuesz</span><span class="p">}</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100000</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of points limited to 100000&#39;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">100000</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">])</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Valuesx</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Valuesy</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elements</span><span class="p">[</span><span class="n">indicez</span><span class="p">]))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                    <span class="n">hue</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">z</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elements</span><span class="p">[</span><span class="n">indicex</span><span class="p">]))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elements</span><span class="p">[</span><span class="n">indicey</span><span class="p">]))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 class="doc doc-heading" id="marcia.mask.Mask.load_table">
<code class="highlight language-python"><span class="n">load_table</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Load the spreadsheet into the programm.
Verification if information of colors are required for
the classification. Colors are also specified in the spreadsheet.</p>

        <details class="quote">
          <summary>Source code in <code>marcia/mask.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">load_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load the spreadsheet into the programm.</span>
<span class="sd">    Verification if information of colors are required for</span>
<span class="sd">    the classification. Colors are also specified in the spreadsheet.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if table is csv/txt or xlsx</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span> <span class="s1">&#39;txt&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>

    <span class="k">elif</span> <span class="s1">&#39;xls&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;invalid Table format.&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Valid data types are: .csv, .txt, or .xls &quot;</span><span class="p">)</span>

    <span class="c1"># Check if table has specific colors for the masks</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;Element&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;ouleur|olor&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">indice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;Element&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;ouleur|olor&#39;</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Creation of dictionnary containing the colors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">coul</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">indice</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">indice</span><span class="p">][</span><span class="n">coul</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">coul</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">indice</span><span class="p">][</span><span class="n">coul</span><span class="p">]</span>

        <span class="c1"># For simplicity in the process, color column is then removed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="n">indice</span><span class="p">])</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 class="doc doc-heading" id="marcia.mask.Mask.mineralcube_creation">
<code class="highlight language-python"><span class="n">mineralcube_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Create a 3D numpy array (X and Y are the dimensions
of the sample and Z dimension is the number of minerals wanted for
the classification).
The minerals are defined by the columns in the spreadsheet. The 2D
array create per mineral depends on the threshold specified in the
spreadsheet.
If one value is given, it corresponds to the minimum threshold to
be in the mineral.
If two values separated by a dash, it corresponds to the range of
values for this element to be in the mineral.
Given values are outside the range.</p>
<p>Each mineral array is binary with 1 where the pixel is in the
mineral and NaN (non assigned) where the pixel is not in the mineral.</p>
<p>The function also creates a dictionnary containing the Z position
of the minerals in the 3D array created.</p>
<p>2 class files created in that function.</p>

        <details class="quote">
          <summary>Source code in <code>marcia/mask.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">mineralcube_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a 3D numpy array (X and Y are the dimensions</span>
<span class="sd">    of the sample and Z dimension is the number of minerals wanted for</span>
<span class="sd">    the classification).</span>
<span class="sd">    The minerals are defined by the columns in the spreadsheet. The 2D</span>
<span class="sd">    array create per mineral depends on the threshold specified in the</span>
<span class="sd">    spreadsheet.</span>
<span class="sd">    If one value is given, it corresponds to the minimum threshold to</span>
<span class="sd">    be in the mineral.</span>
<span class="sd">    If two values separated by a dash, it corresponds to the range of</span>
<span class="sd">    values for this element to be in the mineral.</span>
<span class="sd">    Given values are outside the range.</span>

<span class="sd">    Each mineral array is binary with 1 where the pixel is in the</span>
<span class="sd">    mineral and NaN (non assigned) where the pixel is not in the mineral.</span>

<span class="sd">    The function also creates a dictionnary containing the Z position</span>
<span class="sd">    of the minerals in the 3D array created.</span>

<span class="sd">    2 class files created in that function.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Creation of mineral/mask names dictionnary</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Minerals</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Intializing data cube</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mineral_cube</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

    <span class="c1"># Loop over each mask in order to fill the cube and dictionnary</span>
    <span class="k">for</span> <span class="n">mask</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>

        <span class="c1"># Extract name of the mask</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>

        <span class="c1"># Fill the dictionnary, the key being an integer index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Minerals</span><span class="p">[</span><span class="n">mask</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>

        <span class="c1"># Values are convert to string in order to facilitate later split</span>
        <span class="n">str_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Keeping indices of elements that are used in a mask</span>
        <span class="n">index_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Initializing intermediate 3D array</span>
        <span class="n">mask_i_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                               <span class="n">index_str</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="c1"># Loop over elements of the mask</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">index_str</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">mask_i_str</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">index_str</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span>

            <span class="c1"># If only one value in the table: it corresponds to minimum</span>
            <span class="c1"># threshold</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">str_table</span><span class="p">[</span><span class="n">index_str</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">threshold_min</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                    <span class="n">str_table</span><span class="p">[</span><span class="n">index_str</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">threshold_max</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># If more thant one value (should be 2): it corresponds to the</span>
            <span class="c1"># range of accepted values</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">threshold_min</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                    <span class="n">str_table</span><span class="p">[</span><span class="n">index_str</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">threshold_max</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                    <span class="n">str_table</span><span class="p">[</span><span class="n">index_str</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># If the value are normalized, the threshold is between 0 and</span>
            <span class="c1"># 1: need to compare to maximum value</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalization</span><span class="p">:</span>
                <span class="n">mask_i_str</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">][</span><span class="n">mask_i_str</span><span class="p">[</span>
                    <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">threshold_min</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span>
                        <span class="n">mask_i_str</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">])]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="k">if</span> <span class="n">threshold_max</span><span class="p">:</span>
                    <span class="n">mask_i_str</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">][</span><span class="n">mask_i_str</span><span class="p">[</span>
                        <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">threshold_max</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span>
                            <span class="n">mask_i_str</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">])]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

                <span class="c1"># Values outside thresholds are nan, and valid values are</span>
                <span class="c1"># set to 1</span>
                <span class="n">mask_i_str</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">mask_i_str</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="c1"># If not normalize, threshold is just the number of counts</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mask_i_str</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">][</span><span class="n">mask_i_str</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">]</span>
                                    <span class="o">&lt;</span> <span class="n">threshold_min</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="k">if</span> <span class="n">threshold_max</span><span class="p">:</span>
                    <span class="n">mask_i_str</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">][</span><span class="n">mask_i_str</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">]</span>
                                        <span class="o">&gt;</span> <span class="n">threshold_max</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

                <span class="c1"># Values outside thresholds are nan, and valid values are</span>
                <span class="c1"># set to 1</span>
                <span class="n">mask_i_str</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">mask_i_str</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># 3D array is stacked</span>
        <span class="n">mask_i_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">mask_i_str</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Mask correspond to maximum values: ones that satisfied all</span>
        <span class="c1"># conditions</span>
        <span class="n">mask_i_str</span><span class="p">[</span><span class="n">mask_i_str</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mask_i_str</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="c1"># Mask cube 2D slice is filled with 1 where mask is true</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mineral_cube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">mask</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask_i_str</span> <span class="o">/</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">mask_i_str</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 class="doc doc-heading" id="marcia.mask.Mask.plot_mineral_mask">
<code class="highlight language-python"><span class="n">plot_mineral_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>For mineralogy purposes, valid only if all masks are minerals
Plot all the mask onto one picture in order to visualize
the classification. Each pixel correspond to only one mineral
at the time, if not, it is classified as "mixed".</p>

        <details class="quote">
          <summary>Source code in <code>marcia/mask.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">plot_mineral_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    For mineralogy purposes, valid only if all masks are minerals</span>
<span class="sd">    Plot all the mask onto one picture in order to visualize</span>
<span class="sd">    the classification. Each pixel correspond to only one mineral</span>
<span class="sd">    at the time, if not, it is classified as &quot;mixed&quot;.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

    <span class="n">array</span><span class="p">,</span> <span class="n">proportion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_mineral_mask_and_prop</span><span class="p">()</span>

    <span class="c1"># First plot to generate random colors</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Paired&#39;</span><span class="p">)</span>

    <span class="c1"># Store finite values for later purpose</span>
    <span class="n">finite_values_array</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">array</span><span class="p">)]</span>

    <span class="c1"># Check if mixed pixels, need to add one more value</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mineral_cube</span><span class="p">,</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Minerals</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Minerals</span><span class="p">))</span>

    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">im</span><span class="o">.</span><span class="n">cmap</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="c1"># Test if colors where specify in the table</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">:</span>
        <span class="c1"># If true, specified values are replaced</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">:</span>
            <span class="n">colors</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">value</span><span class="p">]</span>

    <span class="c1"># Generating the new colormap</span>
    <span class="n">new_colormap</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>

    <span class="c1"># Open new figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">array</span><span class="p">,</span>
                    <span class="n">cmap</span><span class="o">=</span><span class="n">new_colormap</span><span class="p">,</span>
                    <span class="n">vmin</span><span class="o">=</span><span class="n">values</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                    <span class="n">vmax</span><span class="o">=</span><span class="n">values</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

    <span class="c1"># create a patch for every color</span>
    <span class="c1"># If true, there are mixed pixels: need to add a patch of mixte</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Minerals</span><span class="p">):</span>
        <span class="n">patches</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span>
                <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                    <span class="n">values</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> : </span><span class="si">{}</span><span class="s2"> %&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Minerals</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)],</span>
                    <span class="nb">str</span><span class="p">(</span>
                        <span class="nb">round</span><span class="p">(</span>
                            <span class="n">proportion</span><span class="p">[</span>
                                <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)],</span>
                            <span class="mi">2</span><span class="p">))))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span>
                <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">round</span><span class="p">(</span>
                <span class="n">proportion</span><span class="p">[</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)],</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>

        <span class="n">patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> : </span><span class="si">{}</span><span class="s2"> %&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s1">&#39;Misclassified&#39;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">array</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span>
                        <span class="n">array</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">array</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
                    <span class="mi">2</span><span class="p">)))))</span>

    <span class="c1"># If False, just add patches of corresponding masks</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">patches</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span>
                <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                        <span class="n">values</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> : </span><span class="si">{}</span><span class="s2"> %&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Minerals</span><span class="p">[</span>
                        <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)],</span> <span class="nb">str</span><span class="p">(</span>
                        <span class="nb">round</span><span class="p">(</span>
                            <span class="n">proportion</span><span class="p">[</span>
                                <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)],</span> <span class="mi">2</span><span class="p">))))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[:]</span> <span class="k">if</span> <span class="nb">round</span><span class="p">(</span>
                                    <span class="n">proportion</span><span class="p">[</span>
                                        <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)],</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Finally add a patch to specify proporty of non-classified pixel</span>
    <span class="c1"># Two reasons : images is bigger than sample or misclassification</span>
    <span class="n">patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> : </span><span class="si">{}</span><span class="s2"> %&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s1">&#39;Not classified&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="nb">round</span><span class="p">(</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">finite_values_array</span><span class="p">))</span>
                        <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                           <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))))</span>

    <span class="c1"># Add patches to the legend</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">patches</span><span class="p">,</span>
               <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
               <span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
               <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Mineralogical classification - &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 class="doc doc-heading" id="marcia.mask.Mask.save_mask">
<code class="highlight language-python"><span class="n">save_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indice</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Save the mineral mask wanted as a .tif file.
Input is the index of the mineral in the 3D array (cube).</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>indice</code></td>
        <td><code>str</code></td>
        <td><p>Name of the wanted element (eg: 'Fe')</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>marcia/mask.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">save_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indice</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">raw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save the mineral mask wanted as a .tif file.</span>
<span class="sd">    Input is the index of the mineral in the 3D array (cube).</span>

<span class="sd">    Args:</span>
<span class="sd">        indice: Name of the wanted element (eg: &#39;Fe&#39;)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">indice</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Minerals</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">indice</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">raw</span><span class="p">:</span>
        <span class="c1"># Conversion of given string indices to integer indice of the cube</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mineral_cube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">indice</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Minerals</span><span class="p">[</span><span class="n">indice</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;Mask_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Minerals</span><span class="p">[</span><span class="n">indice</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">test_array</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mineral_cube</span><span class="p">[</span>
                <span class="p">:,</span>
                <span class="p">:,</span>
                <span class="n">indice</span><span class="p">]</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">test_array</span><span class="p">)</span>
        <span class="n">image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;Mask_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Minerals</span><span class="p">[</span><span class="n">indice</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 class="doc doc-heading" id="marcia.mask.Mask.save_mask_spectrum">
<code class="highlight language-python"><span class="n">save_mask_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Save the mean spectrum of a given mask as a txt file
First column is channel
Second column is counts</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>mask</code></td>
        <td><code>str</code></td>
        <td><p>Name of the wanted mask (eg: 'Galene')</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>marcia/mask.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">save_mask_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Save the mean spectrum of a given mask as a txt file</span>
<span class="sd">    First column is channel</span>
<span class="sd">    Second column is counts</span>

<span class="sd">    Args:</span>
<span class="sd">        mask: Name of the wanted mask (eg: &#39;Galene&#39;)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mineral</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Minerals</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">mask</span><span class="p">))</span>
    <span class="n">cube</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.rpl&quot;</span><span class="p">,</span>
                   <span class="n">signal_type</span><span class="o">=</span><span class="s2">&quot;EDS_SEM&quot;</span><span class="p">,</span>
                   <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">cube</span><span class="p">)</span>
    <span class="n">array</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mineral_cube</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">mineral</span><span class="p">])]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">cube</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">signals</span><span class="o">.</span><span class="n">Signal1D</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="n">spectrum</span> <span class="o">=</span> <span class="n">cube</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Counts&#39;</span><span class="p">:</span> <span class="n">spectrum</span><span class="p">}</span>
    <span class="n">dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">d</span><span class="p">)</span>
    <span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;channel&#39;</span>
    <span class="n">dataframe</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">mask</span> <span class="o">+</span> <span class="s1">&#39;_mean_spectrum.txt&#39;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
      
        <a href="examples/Tutorial.html" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Docs
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "assets/javascripts/workers/search.4fa0e4ee.min.js", "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.1d3bfcf1.min.js"></script>
      
    
  </body>
</html>